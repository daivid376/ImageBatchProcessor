@echo off
setlocal enabledelayedexpansion

REM 需要添加的 IP/域名
set "NEW_ENTRY=100.83.*"

REM 注册表路径
set "REG_PATH=HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
set "REG_VALUE=ProxyOverride"

REM 读取当前值（去掉回车换行）
for /f "tokens=2,* skip=2" %%A in ('reg query "%REG_PATH%" /v "%REG_VALUE%" 2^>nul') do (
    set "CURRENT=%%B"
)

REM 如果原值为空则直接设置
if "%CURRENT%"=="" (
    reg add "%REG_PATH%" /v "%REG_VALUE%" /t REG_SZ /d "%NEW_ENTRY%" /f >nul
    echo 已添加: %NEW_ENTRY%
    exit /b
)

REM 检查是否已包含
echo %CURRENT% | find /i "%NEW_ENTRY%" >nul
if %errorlevel%==0 (
    echo 已存在: %NEW_ENTRY% ，无需添加
) else (
    REM 用分号连接
    set "UPDATED=%CURRENT%;%NEW_ENTRY%"
    reg add "%REG_PATH%" /v "%REG_VALUE%" /t REG_SZ /d "%UPDATED%" /f >nul
    echo 已追加: %NEW_ENTRY%
)

endlocal
